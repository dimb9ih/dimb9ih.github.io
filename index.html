<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">

<title>ü§ñ IFBot –°—Ç–∞—Ç—É—Å</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

<style>
/* ======= –í–ï–°–¨ –¢–í–û–ô CSS –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô ======= */
/* –Ø –µ–≥–æ –Ω–µ —Ç—Ä–æ–≥–∞–ª, –æ–Ω —Ä–∞–±–æ—á–∏–π */
</style>
</head>

<body>
<div class="bg-pattern"></div>
<div class="auto-refresh-indicator" id="autoRefreshIndicator"></div>

<div class="container">

<!-- HEADER -->
<div class="header">
  <h1>ü§ñ IFBot –°—Ç–∞—Ç—É—Å</h1>
  <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–æ—Ç–∞ –¥–ª—è Iron Force</p>
  <div class="status-indicator" id="statusIndicator">
    <div class="status-dot"></div>
    <span id="status-text">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</span>
  </div>
</div>

<!-- SYSTEM STATS -->
<div class="system-stats">
  <div class="system-card cpu-card">
    <div class="system-icon">‚ö°</div>
    <div class="system-label">CPU</div>
    <div class="system-value" id="cpu-load">0%</div>
    <div class="system-detail" id="cpu-detail">‚Äî</div>
  </div>

  <div class="system-card ram-card">
    <div class="system-icon">üíæ</div>
    <div class="system-label">RAM</div>
    <div class="system-value" id="ram-usage">0%</div>
    <div class="system-detail" id="ram-detail">‚Äî</div>
  </div>

  <div class="system-card disk-card">
    <div class="system-icon">üíø</div>
    <div class="system-label">DISK</div>
    <div class="system-value" id="disk-usage">0%</div>
    <div class="system-detail" id="disk-detail">‚Äî</div>
  </div>
</div>

<!-- GRAPHS -->
<div class="graphs-section">
  <h3>üìà –ò—Å—Ç–æ—Ä–∏—è</h3>

  <div class="graph-tabs">
    <div class="graph-tab active" data-graph="cpu">CPU</div>
    <div class="graph-tab" data-graph="ram">RAM</div>
    <div class="graph-tab" data-graph="errors">–û—à–∏–±–∫–∏</div>
    <div class="graph-tab" data-graph="cycle">–¶–∏–∫–ª—ã</div>
  </div>

  <div class="graph-container">
    <canvas id="statsChart"></canvas>
  </div>

  <div class="graph-info" id="graphInfo">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
</div>

<!-- LOGS -->
<div class="logs-card">
  <div class="logs-header">
    <h3>üìù –õ–æ–≥–∏</h3>
    <div class="update-badge" id="update-count">0</div>
  </div>
  <div class="logs-container" id="logs-content">
    <div class="log-entry">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö‚Ä¶</div>
  </div>
</div>

</div>

<script>
/* ================= –ù–ê–°–¢–†–û–ô–ö–ò ================= */
const JSON_URL = 'https://raw.githubusercontent.com/dimb9ih/dimb9ih.github.io/master/ifbot_stats.json';
const HISTORY_URL = 'https://raw.githubusercontent.com/dimb9ih/dimb9ih.github.io/master/history/summary.json';
const REFRESH_INTERVAL = 30000;

/* ================= STATE ================= */
let historyChart = null;
let currentGraphType = 'cpu';
let updateCount = 0;

/* ================= DOM ================= */
const el = id => document.getElementById(id);

/* ================= TIME ================= */
function formatTime(sec) {
  if (sec < 60) return `${sec}—Å`;
  if (sec < 3600) return `${Math.floor(sec/60)}–º`;
  return `${Math.floor(sec/3600)}—á`;
}

/* ================= DATA ================= */
async function fetchData() {
  try {
    const r = await fetch(JSON_URL + '?t=' + Date.now());
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    const d = await r.json();

    el('cpu-load').textContent = `${Math.round(d.system_stats?.cpu?.utilization_percent || 0)}%`;
    el('ram-usage').textContent = `${Math.round(d.system_stats?.memory?.utilization_percent || 0)}%`;
    el('disk-usage').textContent = `${(d.system_stats?.disk?.usage_percent || '0').replace('%','')}%`;

    el('status-text').textContent = d.bot_status || 'unknown';

    updateCount++;
    el('update-count').textContent = updateCount;

    if (d.last_log) renderLogs(d.last_log);

  } catch (e) {
    el('logs-content').innerHTML =
      `<div class="log-entry error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>`;
  }
}

/* ================= LOGS ================= */
function renderLogs(text) {
  const lines = text.split('\n').slice(-8);
  el('logs-content').innerHTML = '';
  lines.forEach(l => {
    const div = document.createElement('div');
    div.className = 'log-entry';
    div.textContent = l;
    el('logs-content').appendChild(div);
  });
}

/* ================= GRAPHS ================= */
async function loadHistory() {
  const r = await fetch(HISTORY_URL + '?t=' + Date.now());
  const j = await r.json();
  drawChart(j.data || []);
}

function drawChart(data) {
  if (!data.length) return;

  const ctx = document.getElementById('statsChart');
  if (historyChart) historyChart.destroy();

  historyChart = new Chart(ctx, {
    type: 'line',
    data: {
      datasets: [{
        label: currentGraphType,
        data: data.map(d => ({
          x: (d.timestamp || d.t) * 1000,
          y: d[currentGraphType] || 0
        })),
        borderWidth: 2,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: { type: 'time' },
        y: { beginAtZero: true }
      }
    }
  });
}

/* ================= INIT ================= */
document.querySelectorAll('.graph-tab').forEach(tab => {
  tab.onclick = () => {
    document.querySelectorAll('.graph-tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    currentGraphType = tab.dataset.graph;
    loadHistory();
  };
});

fetchData();
loadHistory();
setInterval(fetchData, REFRESH_INTERVAL);
</script>

</body>
</html>
