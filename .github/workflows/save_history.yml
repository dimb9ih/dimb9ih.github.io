name: Save Bot History

on:
  schedule:
    - cron: '0,30 * * * *'  # Ð’ 0 Ð¸ 30 Ð¼Ð¸Ð½ÑƒÑ‚ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ñ‡Ð°ÑÐ°
  workflow_dispatch:

jobs:
  save-history:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      
    - name: Download current stats
      run: |
        echo "ðŸ”„ Downloading current stats..."
        curl -s -o current.json "https://raw.githubusercontent.com/dimb9ih/dimb9ih.github.io/master/ifbot_stats.json"
        
        if [ -s current.json ]; then
          echo "âœ… Download successful"
        else
          echo "âŒ Download failed"
          exit 1
        fi
        
    - name: Save to history
      run: |
        mkdir -p history
        TIMESTAMP=$(date -u +"%Y%m%d_%H%M%S")
        FILENAME="ifbot_${TIMESTAMP}.json"
        mv current.json "history/${FILENAME}"
        echo "ðŸ“ Saved: ${FILENAME}"
        
    - name: Create summary (simple)
      run: |
        echo "ðŸ“Š Creating summary..."
        # ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ - ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¸Ð¼ÐµÐ½Ð° Ñ„Ð°Ð¹Ð»Ð¾Ð²
        ls -1 history/ifbot_*.json 2>/dev/null | tail -50 > history/filelist.txt || echo "No files yet" > history/filelist.txt
        echo "Summary created at $(date)" >> history/filelist.txt
        
    - name: Commit and push
      run: |
        git config --global user.email "github-actions@users.noreply.github.com"
        git config --global user.name "GitHub Actions"
        git add history/
        git commit -m "ðŸ¤– Auto-save: $(date -u '+%Y-%m-%d %H:%M')" || echo "No changes"
        git push
